<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Инструмент для инклисирана</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
    h1 { color: #2a4d69; }
    label { display: block; margin-top: 10px; }
    input[type="text"], input[type="number"], select {
      width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc;
    }
    button {
      margin-top: 15px; padding: 10px 20px; border: none; background: #2a4d69; color: white;
      border-radius: 5px; cursor: pointer;
    }
    .card {
      background: white; padding: 15px; border-radius: 8px; margin-top: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .result-good { color: green; font-weight: bold; }
    .result-bad { color: red; font-weight: bold; }
    .delete-button {
      margin-top: 10px; padding: 6px 10px; background: #b22222; color: white;
      border: none; border-radius: 4px; cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Проверка пациента на инклисиран</h1>

  <label>ФИО:</label>
  <input type="text" id="fio" />

  <label>Город:</label>
  <input type="text" id="city" />

  <label>ЛПНП (ммоль/л):</label>
  <input type="number" step="0.1" id="ldl" />

  <label>Препарат:</label>
  <select id="statin">
    <option value="atorvastatin">Аторвастатин</option>
    <option value="rosuvastatin">Розувастатин</option>
    <option value="simvastatin">Симвастатин</option>
  </select>

  <label>Доза статина (мг):</label>
  <input type="number" id="dose" />

  <label>Принимает эзетимиб:</label>
  <select id="ezetimibe">
    <option value="yes">Да</option>
    <option value="no">Нет</option>
  </select>

  <label>Сопутствующие состояния:</label>
  <label><input type="checkbox" id="ibs" /> ИБС</label>
  <label><input type="checkbox" id="stroke" /> Инсульт</label>
  <label><input type="checkbox" id="dm" /> Сахарный диабет</label>
  <label><input type="checkbox" id="ckd" /> ХБП</label>
  <label><input type="checkbox" id="pad" /> ПАД</label>

  <button onclick="checkPatient()">Проверить и сохранить</button>

  <div id="patients"></div>

  <script>
    function checkEligibility(ldl, statin, dose, ezetimibe, conditions) {
      const maxDoses = {
        atorvastatin: 80,
        rosuvastatin: 40,
        simvastatin: 40
      };

      const hasHighDose = dose >= maxDoses[statin];
      const hasEzetimibe = ezetimibe === 'yes';
      const hasCondition = Object.values(conditions).some(v => v);
      const ldlTooHigh = ldl >= 1.4;

      return hasHighDose && hasEzetimibe && hasCondition && ldlTooHigh;
    }

    function checkPatient() {
      const fio = document.getElementById('fio').value;
      const city = document.getElementById('city').value;
      const ldl = parseFloat(document.getElementById('ldl').value);
      const statin = document.getElementById('statin').value;
      const dose = parseInt(document.getElementById('dose').value);
      const ezetimibe = document.getElementById('ezetimibe').value;
      const conditions = {
        ibs: document.getElementById('ibs').checked,
        stroke: document.getElementById('stroke').checked,
        dm: document.getElementById('dm').checked,
        ckd: document.getElementById('ckd').checked,
        pad: document.getElementById('pad').checked,
      };

      const eligible = checkEligibility(ldl, statin, dose, ezetimibe, conditions);
      const date = new Date().toLocaleDateString();

      const patient = {
        fio, city, ldl, statin, dose, ezetimibe, conditions, eligible, date
      };

      let saved = JSON.parse(localStorage.getItem('patients') || '[]');
      saved.push(patient);
      localStorage.setItem('patients', JSON.stringify(saved));

      displayPatients();
    }

    function displayPatients() {
      const container = document.getElementById('patients');
      container.innerHTML = '';
      let saved = JSON.parse(localStorage.getItem('patients') || '[]');
      saved.forEach((p, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <strong>${p.fio}</strong><br/>
          Город: ${p.city} <br/>
          Дата: ${p.date}<br/>
          ЛПНП: ${p.ldl} ммоль/л<br/>
          Статин: ${p.statin} ${p.dose} мг<br/>
          Эзетимиб: ${p.ezetimibe === 'yes' ? 'Да' : 'Нет'}<br/>
          Сопутствующие: ${Object.entries(p.conditions).filter(([k,v])=>v).map(([k])=>k.toUpperCase()).join(', ') || 'Нет'}<br/>
          <div class="${p.eligible ? 'result-good' : 'result-bad'}">
            ${p.eligible ? 'Пациент ПОДХОДИТ для инклисирана' : 'Пациент НЕ подходит'}
          </div>
          <button class="delete-button" onclick="deletePatient(${index})">Удалить</button>
        `;
        container.appendChild(card);
      });
    }

    function deletePatient(index) {
      let saved = JSON.parse(localStorage.getItem('patients') || '[]');
      saved.splice(index, 1);
      localStorage.setItem('patients', JSON.stringify(saved));
      displayPatients();
    }

    displayPatients();
  </script>
</body>
</html>

