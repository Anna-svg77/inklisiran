<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Критерии назначения Инклисирана</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f8f9fa; }
    label { display: block; margin-top: 10px; }
    input, select, button { margin-top: 5px; padding: 5px; width: 100%; max-width: 300px; }
    .result { margin-top: 20px; padding: 15px; border-radius: 5px; }
    .eligible { background-color: #d4edda; color: #155724; }
    .not-eligible { background-color: #f8d7da; color: #721c24; }
    .patient-card { border: 1px solid #ccc; padding: 10px; margin-top: 10px; border-radius: 5px; background: white; }
    .patient-card button { margin-top: 5px; background-color: #dc3545; color: white; border: none; padding: 5px 10px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Форма оценки пациента для назначения Инклисирана</h2>

  <label>ФИО пациента: <input id="fio" type="text"></label>
  <label>Город: <input id="city" type="text"></label>
  <label>Дата: <input id="date" type="date"></label>

  <label>ЛПНП (ммоль/л): <input id="ldl" type="number" step="0.1"></label>

  <label>Применяет максимальную дозу статинов:</label>
  <select id="statin">
    <option value="atorvastatin">Аторвастатин ≥ 40 мг</option>
    <option value="rosuvastatin">Розувастатин ≥ 20 мг</option>
    <option value="simvastatin">Симвастатин ≥ 40 мг</option>
    <option value="no">Нет</option>
  </select>

  <label>Принимает эзетемиб:</label>
  <select id="ezetimibe">
    <option value="yes">Да</option>
    <option value="no">Нет</option>
  </select>

  <label>Факт ИБС / ИМ / инсульта / ПА:</label>
  <select id="cvd">
    <option value="yes">Да</option>
    <option value="no">Нет</option>
  </select>

  <button onclick="checkEligibility()">Оценить</button>

  <div id="result"></div>
  <button onclick="savePatient()">Сохранить пациента</button>

  <h3>Список пациентов</h3>
  <div id="patients"></div>

  <script>
    function checkEligibility() {
      const ldl = parseFloat(document.getElementById('ldl').value);
      const statin = document.getElementById('statin').value;
      const ezetimibe = document.getElementById('ezetimibe').value;
      const cvd = document.getElementById('cvd').value;
      let eligible = false;

      const statinOk = statin !== 'no';
      const ezOk = ezetimibe === 'yes';
      const hasCVD = cvd === 'yes';

      if (hasCVD && statinOk && ezOk && ldl >= 1.4) eligible = true;
      else if (!hasCVD && statinOk && ezOk && ldl >= 2.6) eligible = true;

      const resultDiv = document.getElementById('result');
      resultDiv.className = 'result ' + (eligible ? 'eligible' : 'not-eligible');
      resultDiv.innerText = eligible ? 'Пациент подходит под критерии назначения Инклисирана' : 'Пациент НЕ подходит под критерии назначения Инклисирана';
      return eligible;
    }

    function savePatient() {
      const fio = document.getElementById('fio').value;
      const city = document.getElementById('city').value;
      const date = document.getElementById('date').value;
      const ldl = document.getElementById('ldl').value;
      const statin = document.getElementById('statin').value;
      const ezetimibe = document.getElementById('ezetimibe').value;
      const cvd = document.getElementById('cvd').value;
      const eligible = checkEligibility();

      const patient = { fio, city, date, ldl, statin, ezetimibe, cvd, eligible };
      let patients = JSON.parse(localStorage.getItem('patients') || '[]');
      patients.push(patient);
      localStorage.setItem('patients', JSON.stringify(patients));
      renderPatients();
    }

    function renderPatients() {
      const container = document.getElementById('patients');
      container.innerHTML = '';
      const patients = JSON.parse(localStorage.getItem('patients') || '[]');
      patients.forEach((p, i) => {
        const div = document.createElement('div');
        div.className = 'patient-card';
        div.innerHTML = `<strong>${p.fio}</strong> (${p.city}, ${p.date})<br>
          ЛПНП: ${p.ldl} ммоль/л<br>
          Статин: ${p.statin}<br>
          Эзетимиб: ${p.ezetimibe}<br>
          ССЗ: ${p.cvd}<br>
          <strong>${p.eligible ? 'Подходит' : 'Не подходит'} под инклисиран</strong><br>
          <button onclick="deletePatient(${i})">Удалить</button>`;
        container.appendChild(div);
      });
    }

    function deletePatient(index) {
      let patients = JSON.parse(localStorage.getItem('patients') || '[]');
      patients.splice(index, 1);
      localStorage.setItem('patients', JSON.stringify(patients));
      renderPatients();
    }

    renderPatients();
  </script>
</body>
</html>
