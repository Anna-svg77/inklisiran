<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Критерии назначения Инклисирана</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    label, select, input, textarea { display: block; margin-top: 10px; }
    .patient { border: 1px solid #ccc; padding: 10px; margin-top: 10px; }
    .match { background-color: #e0ffe0; }
    .no-match { background-color: #ffe0e0; }
    .remove-btn { margin-top: 5px; }
  </style>
</head>
<body>
  <h1>Оценка пациента для назначения Инклисирана</h1>

  <label>ФИО:</label>
  <input type="text" id="fio" />

  <label>Город:</label>
  <input type="text" id="city" />

  <label>ЛПНП (ммоль/л):</label>
  <input type="number" step="0.1" id="ldl" />

  <label>Принимает статин в максимально переносимой дозе:</label>
  <select id="statinMax">
    <option value="нет">Нет</option>
    <option value="да">Да</option>
  </select>

  <label>Принимает эзетимиб:</label>
  <select id="ezetimibe">
    <option value="нет">Нет</option>
    <option value="да">Да</option>
  </select>

  <label>Факторы риска (выберите все подходящие):</label>
  <label><input type="checkbox" class="risk" value="ССС заболевание" /> ССС заболевание</label>
  <label><input type="checkbox" class="risk" value="ИМ" /> Инфаркт миокарда</label>
  <label><input type="checkbox" class="risk" value="Инсульт" /> Инсульт</label>
  <label><input type="checkbox" class="risk" value="СД" /> Сахарный диабет</label>
  <label><input type="checkbox" class="risk" value="ХБП" /> Хроническая болезнь почек</label>
  <label><input type="checkbox" class="risk" value="Гипертония" /> Артериальная гипертензия</label>

  <button onclick="evaluatePatient()">Оценить</button>
  <button onclick="savePatient()">Сохранить пациента</button>

  <div id="result"></div>

  <h2>Сохранённые пациенты</h2>
  <div id="savedPatients"></div>

  <script>
    function getRiskLevel(factors) {
      if (factors.includes("ИМ") || factors.includes("Инсульт")) return "экстремальный";
      if (factors.includes("ССС заболевание") || factors.includes("СД") || factors.includes("ХБП")) return "очень высокий";
      if (factors.includes("Гипертония")) return "высокий";
      return "не определён";
    }

    function getTargetLDL(risk) {
      switch (risk) {
        case "экстремальный": return 1.0;
        case "очень высокий": return 1.4;
        case "высокий": return 1.8;
        default: return 2.6;
      }
    }

    function evaluatePatient() {
      const ldl = parseFloat(document.getElementById("ldl").value);
      const statinMax = document.getElementById("statinMax").value;
      const ezetimibe = document.getElementById("ezetimibe").value;
      const risks = Array.from(document.querySelectorAll(".risk:checked")).map(cb => cb.value);
      const riskLevel = getRiskLevel(risks);
      const targetLDL = getTargetLDL(riskLevel);
      const matches = (ldl > targetLDL && statinMax === "да" && ezetimibe === "да");

      document.getElementById("result").innerHTML = `
        <div class="${matches ? 'match' : 'no-match'}">
          <p>Риск: <strong>${riskLevel}</strong></p>
          <p>Целевой ЛПНП: <strong>< ${targetLDL} ммоль/л</strong></p>
          <p>Пациент ${matches ? '<strong>подходит</strong>' : '<strong>не подходит</strong>'} для назначения инклисирана</p>
        </div>
      `;
    }

    function savePatient() {
      const fio = document.getElementById("fio").value;
      const city = document.getElementById("city").value;
      const ldl = document.getElementById("ldl").value;
      const statinMax = document.getElementById("statinMax").value;
      const ezetimibe = document.getElementById("ezetimibe").value;
      const risks = Array.from(document.querySelectorAll(".risk:checked")).map(cb => cb.value);
      const riskLevel = getRiskLevel(risks);
      const targetLDL = getTargetLDL(riskLevel);
      const match = (ldl > targetLDL && statinMax === "да" && ezetimibe === "да");

      const patient = { fio, city, ldl, statinMax, ezetimibe, risks, riskLevel, match };
      let patients = JSON.parse(localStorage.getItem("patients") || "[]");
      patients.push(patient);
      localStorage.setItem("patients", JSON.stringify(patients));
      renderSaved();
    }

    function renderSaved() {
      const patients = JSON.parse(localStorage.getItem("patients") || "[]");
      const container = document.getElementById("savedPatients");
      container.innerHTML = "";
      patients.forEach((p, i) => {
        const div = document.createElement("div");
        div.className = `patient ${p.match ? 'match' : 'no-match'}`;
        div.innerHTML = `
          <p><strong>ФИО:</strong> ${p.fio}</p>
          <p><strong>Город:</strong> ${p.city}</p>
          <p><strong>ЛПНП:</strong> ${p.ldl} ммоль/л</p>
          <p><strong>Статин в максимальной дозе:</strong> ${p.statinMax}</p>
          <p><strong>Эзетимиб:</strong> ${p.ezetimibe}</p>
          <p><strong>Факторы риска:</strong> ${p.risks.join(", ")}</p>
          <p><strong>Риск:</strong> ${p.riskLevel}</p>
          <p><strong>Рекомендация:</strong> ${p.match ? 'Пациент подходит' : 'Пациент не подходит'} для назначения инклисирана</p>
          <button class="remove-btn" onclick="removePatient(${i})">Удалить</button>
        `;
        container.appendChild(div);
      });
    }

    function removePatient(index) {
      let patients = JSON.parse(localStorage.getItem("patients") || "[]");
      patients.splice(index, 1);
      localStorage.setItem("patients", JSON.stringify(patients));
      renderSaved();
    }

    window.onload = renderSaved;
  </script>
</body>
</html>
